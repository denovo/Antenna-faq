/* 
  ES Javascript API Library
  ================================================
  Author Yuri Fukuda 2016/04/21

  Copyright 2016 EachScape, Inc All rights reserved.

  You are solely responsible for determining the appropriateness of using or redistributing the Work and risks of breakage.

*/
/**
 * #EObject
 *  This component is a set of common functionality for 
 *  all instance of eachscape library component.
 * 
 * ##Example:
 *  `yourClass extends EObject
 *     .. place yoru implementation here ... 
 *  ` 
 *
 *//*!
 * Copyright 2015 Yuri Fukuda
 * required library : 
 * Revision History
 * Date    Version    CreatedBy    Description
 * ---------------------------------------------------
 * Feb 14  0.0.1      Yuri Fukuda  Created
 */(function(){this.EObject=function(){function c(){}var a="__name__",b=function(a,b){var c=new Function("constructor","return function "+a+"()\n"+"{\n"+'    // wrapper function created dynamically for "'+a+'" constructor to allow instances to be identified in the debugger\n'+"    constructor.apply(this, arguments);\n"+"};");return c(b)};c.esNameSpace="es",c.prototype.confVal={},c.merge=function(a){if(!EUtil.isObject(a))return a;var b,c;for(var d=1,e=arguments.length;d<e;d++){b=arguments[d];for(c in b)hasOwnProperty.call(b,c)&&(a[c]=b[c])}return a},c.extends=function(c,d){function j(){this.constructor=h}var e="child",f=null;c&&c.hasOwnProperty(a)&&(e=c[a]||"child"),f=c.hasOwnProperty("constructor")?c.constructor:this,c=EUtil.merge(c,{constructor:b(e,f)});var g=this,h=c.constructor;for(var i in g)EUtil.hasOwnProperty(g,i)&&(h[i]=g[i]);for(var i in d)EUtil.hasOwnProperty(d,i)&&(h[i]=d[i]);j.prototype=g.prototype,h.prototype=new j,EUtil.merge(h.prototype,c),h.__super__=g.prototype;return h},c.prop=function(a,b,d){var e;a=a,c.prototype[a]=b;if(a!==null){e=""+a[0].toUpperCase()+(a.length>1?a.slice(1):""),c.prototype["set"+e]=function(b){return this.set(a,b)},c.prototype["get"+e]=function(){return this.get(a)};return null}},c.prototype.debugFlag=!1,c.prototype.toString=function(){return this.constructor.name},c.prototype.log=function(a,b){this.debugFlag&&ELog.log(this,a),(b!=null?b.debugFlag:void 0)&&ELog.log(b,a);if(window.debugFlag!=null)return ELog.log(null,a)},c.prototype.get=function(a){if(a in this)return this[a];return null},c.prototype.set=function(a,b){a in this&&(this[a]=b);return null};return c}(),this.EObject.prop("name","",null)}).call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype;return b},c=[].slice;this.ELog=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}b(d,a),d.debugFlag=!1,d.initialize=function(){if(d.debugFlag||(typeof debugFlag!="undefined"&&debugFlag!==null?debugFlag:!1))return window.onerror=function(a,b,c){return alert(""+a+"url:"+b+"lineNumber:"+c)}},d.log=function(){var a,b;b=arguments[0],a=2<=arguments.length?c.call(arguments,1):[];return this.call(b,"log",a)},d.debug=function(){var a,b;b=arguments[0],a=2<=arguments.length?c.call(arguments,1):[];return this.call(b,"debug",a)},d.info=function(){var a,b;b=arguments[0],a=2<=arguments.length?c.call(arguments,1):[];return this.call(b,"log",a)},d.warn=function(){var a,b;b=arguments[0],a=2<=arguments.length?c.call(arguments,1):[];return this.call(b,"warn",a)},d.error=function(){var a,b;b=arguments[0],a=2<=arguments.length?c.call(arguments,1):[];return this.call(b,"warn",a)},d.call=function(a,b,c){if(typeof console!="undefined"&&console!==null&&console[b])return console[b]("["+(a?a!=null?a.toString():void 0:"Global")+"] "+c[0])},d.dumpObj=function(a,b){var c,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;f="";try{p="";if(b===null||typeof b=="undefined")b=0;for(n=u=0,v=b+1;0<=v?u<v:u>v;n=0<=v?++u:--u)p+="    ";r="",h="",j=a!==null&&typeof a=="object"&&a.constructor===Array,k=a!==null&&typeof a=="object"&&a.constructor!==Array,l=typeof a=="string",j&&(r="[\n",h="]\n"),k&&(r="{\n",h="}\n"),l&&(r='"',h='"');if(typeof a=="object"){f+="\n"+p+r,c=a,e=0,q=0;for(o in c)i=c[o],q++;for(o in c)m=c[o],e++,t=c[o],f+=""+p+'"'+o+'":'+d.dumpObj(t,b+1),e!==q&&(f+=",\n");f+=""+p+h}else typeof a!="function"&&(s=a!==null?a:"null",a.length===0&&r.length===0&&(s="null"),r==='"'&&(s=s.replace(/\"/g,'\\"')),f+=r+s+h)}catch(w){g=w,alert(g)}return f};return d}(EObject),ELog.initialize()}.call(this),function(){this.EUtil=function(){function a(){}a.TEMPLATEMATHCER=/###(\w+)###/,a.toCammelCase=function(a){var b;b=null,(a!=null?a.length:void 0)>0&&(b=""+a[0].toLowerCase()+a.slice(1));return b},a.namespace=function(b,c,d){var e,f,g,h;g=null,h=c,c===null&&(h=window);if(!(b.length>0&&typeof b=="string"))return null;e=b.split("."),f=null;if(a.hasOwnProperty(h,e[0]))return f=h[e[0]];if(e.length===1)return h[e[0]]=d===null?{}:d;if(e.length>1){h[e[0]]={};return a.namespace(e.slice(1).join("."),h[e[0]])}},a.hasOwnProperty=function(a,b){var c,d;d=arguments.length===1?window:a,c=arguments.length===1?a:b;return c in d||d.hasOwnProperty(c)},a.merge=function(a){var b,c,d,e,f,g,h;if(!this.isObject(a))return a;var d,c;for(b=e=1,h=arguments.length;1<=h?e<h:e>h;b=1<=h?++e:--e){d=arguments[b];for(c in d)this.hasOwnProperty(d,c)&&(a[c]=d[c])}return a},a.replacePattern=function(a,b,c){var d,e,f,g,h;g="",d=ESUtility.TEMPLATEMATHCER,c&&(d=c),g=a;while(e=d.exec(g))h="",f=b[e[1]],f!=="undefined"&&(typeof f=="function"?h=f():h=f),g=g.replace(d,h);return g},a.blank=function(a){var b;b=!0,typeof a!="undefined"&&(typeof a=="string"?a.trim().length>0&&(b=!1):Array.isArray(a)?a.length>0&&(b=!1):a!==null&&(b=!1));return b},a.isObject=function(a){var b;b=typeof a;return b==="function"||b==="object"&&!!a},a.isNumber=function(a){var b;b=a,typeof b=="string"&&(b=b.trim());return typeof b!="undefined"&&b!==null&&b!==""&&typeof b!="object"&&!isNaN(b)},a.compare=function(a,b){if(typeof a=="string"&&typeof b=="string")ESUtility.IntlSupported?(new Intl.Collator).compare(a,b):a.localeCompare(b);else{if(a>b)return 1;if(a<b)return-1}return 0};return a}(),EUtil.IntlSupported=typeof Intl=="object"}.call(this),function(){window.ES=window.ES||{},window.ES.Error=function(b){this.name="MyError",this.message=b,this.stack=(new Error).stack},EUtil.merge(window.ES.Error,Error.prototype),window.ES.API=EObject.extends({initialize:function(){this._initializeHiddenClick()},sendMessage:function(a,b,c){this._setMessage(a,b,c),this._sendToClient()},_initializeHiddenClick:function(){var a=document.createElement("a");a.href="",a.style.display="inline-block",a.style.position="fixed",a.style.left="-100%",a.style.right="-100%",document.body.appendChild(a),this.hiddenTrigger=a},_setMessage:function(a,b,c){var c=c||{},d=null,e=/[a-zA-Z]+[a-zA-Z\d\_]*$/;try{var f=Object.keys(c),g=[];f.forEach(function(a,b){if(a.match(e)==null)throw ES.Error("Invalid variable key name "+a);var d=c[a];g.push(a+"="+encodeURI(d))}),d=g.join("&"),d.length>0&&(d="?"+d)}catch(h){ELog.error(h);return}this.hiddenTrigger.href=a+":"+b+d},_sendToClient:function(){this._triggerClick(this.hiddenTrigger)},_triggerClick:function(a){var b,a=a;setTimeout(function(){b=null;if(document.createEventObject){b=document.createEventObject();return a.fireEvent("onclick",b)}b=document.createEvent("MouseEvents");if(b.initMouseEvent){b.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null);return a.dispatchEvent(b)}},100)}},{initialize:function(){window.ES.API._api=new ES.API,window.ES.API._api.initialize()},requestEvent:function(a){(EUtil.blank(a)||EUtil.blank(a.name))&&ELog.error("define data.name, and data.variable( optional )");var a=a||{},b=a.name,c=a.variables||{};EUtil.blank(window.ES.API._api)?ELog.error("call ES.API.initialize() first"):ES.API._api.sendMessage("event",b,c)},requestScript:function(a){(EUtil.blank(a)||EUtil.blank(a.name))&&ELog.error("define data.name, and data.variable( optional )");var a=a||{},b=a.name,c=a.variables||{};EUtil.blank(window.ES.API._api)?ELog.error("call ES.API.initialize() first"):ES.API._api.sendMessage("script",b,c)}})}.call(this)